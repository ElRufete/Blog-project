{% extends "blog/layout.html" %}
{% load django_bootstrap5 %}
{% load timeago %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}

<title>Home</title>
{% block content%}
    <div class="blackboard">
        <div class="friends-row mt-2">
            <div>
                <p class="me-auto blog-options">
                    <a href="{% url 'blog:blogs_list' %}">&laquo; Atrás </a>
                </p>
            </div>
        </div>
            {% if blog.author == request.user or request.user in blog_collabs %}

            <div class="btn-group ms-auto">
                <form action="{% url 'blog:new_entry' blog.id %}">
                <button type="submit" class="btn btn-primary btn-sm">Nueva entrada</button>
                </form>
                {% if blog.author == request.user %}
                    <button type="button" class="btn btn-sm btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"
                    aria-expanded="false">
                        <span class="visually-hidden">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'blog:edit_blog' blog.id %}">Editar</a></li>
                        <li><a class="dropdown-item" href="{% url 'collaborators:add_collab_page' blog.id %}">Añadir colaborador</a></li>
                        <li><a class="dropdown-item" href="{% url 'collaborators:remove_collab_page' blog.id %}">Eliminar colaborador</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><button type="button" class="dropdown-item bg-danger" style="color:white" 
                            data-bs-toggle="modal" data-bs-target="#deleteBlogModal">
                            Eliminar </button></li>     
                    </ul>
                {% endif %}
            </div>

            <!-- Modal -->
            <div class="modal fade" id="deleteBlogModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="modalLabel">¿Eliminar blog?</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Se eliminarán el blog y todas sus entradas, incluyendo las de colaboradores. ¿Continuar?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Atrás</button>
                    <form action="{% url 'blog:delete_blog' blog.id %}" method="POST">
                                        {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                </div>
                </div>
            </div>
            </div>
            {% endif %}
            
        
    <div class="border-bottom pb-3 mt-3">
        <div class="centered">

            <h2><strong> {{ blog.text }} </strong></h2>

            <p>{{blog.about}}</p>

            <div class="centered-row">
                <a href="{% url 'accounts:user_profile' blog.author.id %}">
                    <img class="push-up me-2" src='{{ blog.author.avatar_medium }}'>
                </a>
                
                <p class="message-link text-muted">
                    <small>Creado por<a href="{% url 'accounts:user_profile' blog.author.id %}">
                        {{ blog.author }}</a>{{ blog.date_added | custom_time_since}}</small>
                </p>
            </div>
        </div>

        <div class="friends-button" id="accordionFlush">
            <div class="accordion-item no-bg">
                <h2 class="accordion-header no-bg" id="flush-headingOne">
                    <button class="accordion-button collapsed no-bg" type="button" 
                    data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" 
                    aria-expanded="false" aria-controls="flush-collapseOne">
                        <p>{{collabs_phrase}}</p>
                    </button>
                </h2>
            </div>
            <div id="flush-collapseOne" class="accordion-collapse collapse no-bg"
            aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlush">
                <div class="accordion-body no-bg">
                    {% for collab in blog_collabs %}
                        <div class="left-row">
                            <img class="push-up me-2" src='{{ collab.avatar_small }}'>
                            <a href="{% url 'accounts:user_profile' collab.id %}">
                                {{collab.user_name}}</a>
                            </div>
                    {% empty %}
                        <p>Este blog no tiene colaboradores aún</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <h3 class="centered">Entradas</h3>
    <div class="left-row m-4 border-bottom">
        {% for entry in entries %}
        <div class="card shadowed m-4 block" style="width: 18rem;">
        
            {% if entry.banner %}
                <img src="{{entry.banner.url}}" class="card-img-top" alt="entry card banner">
            {% endif %}
            <div class="card-body">
                <h5 class="card-title"><strong>{{ entry.title }}</strong></h5>
                
            
            </div>
            <a href="{% url 'blog:entry' blog.id entry.id %}" class="stretched-link"></a>
            <div class="left-row card-footer">
                <a href="{% url 'accounts:user_profile' blog.author.id %}">
                    <img src="{{ entry.author.avatar_small }}">
                </a>

                <p class="text-muted"><small>{{ entry.date_added | custom_time_since }}</small></p>
            </div>
        </div>
        {%empty%}
            {% if request.user == blog.author %}
                <li>Aún no hay entradas para este tema. 
                <a href="{% url 'blog:new_entry' blog.id %}"> ¡Estrénalo! </a></li>
            {% else %}
                <li>Aún no hay entradas para este tema.</li>
            {% endif %}
        {% endfor %}   
    </div>
</div>
{%endblock content%}